#!/usr/bin/env ruby

require 'formatador'
require 'pmap'
require_relative '../lib/opt_processor'
require_relative '../lib/portfolio'
require_relative '../lib/stock'

options   = OptProcessor.parse!
symbols   = ARGV.dup

unless options[:no_portfolio]
  portfolio = Portfolio.new(options)
  symbols   = symbols.concat(portfolio.stock_symbols).uniq
end

exit if symbols.empty?

quotes = []

symbols.peach do |symbol|
  stock = Stock.new symbol

  quotes.push stock.to_h unless stock.price.empty?
end

Formatador.display_table(quotes, quotes.first.keys) unless quotes.empty?
